var n=(m,r,e)=>new Promise((t,i)=>{var s=p=>{try{c(e.next(p))}catch(H){i(H)}},o=p=>{try{c(e.throw(p))}catch(H){i(H)}},c=p=>p.done?t(p.value):Promise.resolve(p.value).then(s,o);c((e=e.apply(m,r)).next())});function X(m){return{all:m=m||new Map,on:function(r,e){var t=m.get(r);t?t.push(e):m.set(r,[e])},off:function(r,e){var t=m.get(r);t&&(e?t.splice(t.indexOf(e)>>>0,1):m.set(r,[]))},emit:function(r,e){var t=m.get(r);t&&t.slice().map(function(i){i(e)}),(t=m.get("*"))&&t.slice().map(function(i){i(r,e)})}}}var y=class{constructor(r){this.mitt=X(r)}get all(){return this.mitt.all}on(r,e){this.mitt.on(r,e)}off(r,e){this.mitt.off(r,e)}emit(r,e){this.mitt.emit(r,e)}};var S=class extends y{constructor({maxAttempts:e=20,timeout:t=1e3}={}){super();this.num=0;this.maxAttempts=e,this.timeout=t}open(e,t=[]){try{this.ws=new WebSocket(e,t)}catch(i){this.emit("error",new Event("error"));return}this.url=e,this.protocols=t,this.ws.addEventListener("message",i=>{this.emit("message",i)}),this.ws.addEventListener("open",i=>{this.emit("open",i),this.num=0,clearTimeout(this.timer)}),this.ws.addEventListener("close",i=>{switch(i.code){case 1e3:case 1001:case 1005:this.emit("close",i),clearTimeout(this.timer);break;case 1006:default:this.num===0&&this.emit("close",i),this.reconnect(i)}}),this.ws.addEventListener("error",i=>{this.emit("error",i)})}get state(){return this.ws.readyState}reconnect(e){this.num++<this.maxAttempts?this.timer=setTimeout(()=>{this.emit("reconnect",this.num),this.open(this.url,this.protocols)},this.timeout||1e3):this.emit("close",e)}json(e){this.ws.send(JSON.stringify(e))}send(e){this.ws.send(e)}close(e=1e3,t="General"){console.log("[AbletonLive] Closing Connection"),this.timer&&clearTimeout(this.timer),this.ws.close(e,t)}};var U=(m=21)=>crypto.getRandomValues(new Uint8Array(m)).reduce((r,e)=>(e&=63,e<36?r+=e.toString(36):e<62?r+=(e-26).toString(36).toUpperCase():e>62?r+="-":r+="_",r),"");var l=class{constructor(r,e,t,i,s){this.ableton=r;this.ns=e;this._path=t;this.childrenInitialProps=i;this._id=s;this._state=new Map;this.getterTransformers={};this.childrenTransformers={}}get id(){return this._id}get path(){return this._path}get(r){return n(this,null,function*(){let e=yield this.ableton.get(this.path,r,this._id),t=this.getterTransformers[r],i=e;return e!==null&&t&&(i=t(e)),i})}children(r,e,t){return n(this,null,function*(){let i;this.childrenInitialProps&&(i=this.childrenInitialProps[r]),e&&(i=i.concat(e));let s=yield this.ableton.getChildren(this.path,{child:r,initialProps:i,index:t},this._id),o=this.childrenTransformers[r];return s!==null&&o?o(s):s})}child(r,e,t){return n(this,null,function*(){let i=yield this.children(r,t,e);return(i!=null?i:[])[0]})}set(r,e){return n(this,null,function*(){return this.ableton.set(this.path,r,e,this._id)})}observe(r,e){return n(this,null,function*(){let t=r,i=this.childrenTransformers[t],s=this.getterTransformers[t],o,c=p=>{e(p!==null&&i?i(p):p!==null&&s?s(p):p)};return this.childrenInitialProps?(o=this.childrenInitialProps[t],this.ableton.observe(this.path,r,c,{initialProps:o,liveObjectId:this._id})):this.ableton.observe(this.path,r,c,{liveObjectId:this._id})})}call(r,e,t){return n(this,null,function*(){return this.ableton.call(this.path,{parameters:e,method:r},this._id,t)})}callMultiple(r,e){return n(this,null,function*(){return this.ableton.callMultiple(this.path,r,this._id,e)})}};var ee=(t=>(t.None="none",t.Overridden="overridden",t.Playing="playing",t))(ee||{}),te=(t=>(t.Disabled="disabled",t.Enabled="enabled",t.Irrelevant="irrelevant",t))(te||{}),_=["name","value","is_quantized"],R=class R extends l{constructor(e,t,i){super(e,"device_parameter",i||R.path);this.raw=t;this._id=t.id,this._name=t.name,this._value=t.value,this._isQuantized=t.is_quantized}get name(){return this._name}get value(){return this._value}get isQuantized(){return this._isQuantized}reEnableAutomation(){return n(this,null,function*(){return this.call("re_enable_automation",[])})}strForValue(e){return n(this,null,function*(){return this.call("str_for_value",[e])})}str(){return n(this,null,function*(){return this.call("__str__",[])})}};R.path="live_set tracks N devices M parameters L";var u=R;var re=(t=>(t[t.A=0]="A",t[t.none=1]="none",t[t.B=2]="B",t))(re||{}),ie=(e=>(e[e.Stereo=0]="Stereo",e[e.SplitStereo=1]="SplitStereo",e))(ie||{}),Y=[{name:"volume",initialProps:_},{name:"panning",initialProps:_}],ne={volume:_,panning:_,sends:_},E=class E extends l{constructor(e,t,i){super(e,"mixer_device",i||E.path,ne);this.raw=t;this._id=t.id,this._volume=new u(this.ableton,t.volume),this._panning=new u(this.ableton,t.panning),this.childrenTransformers={sends:s=>s.map(o=>new u(this.ableton,o))}}get volume(){return this._volume}get panning(){return this._panning}};E.path="live_set tracks $1 mixer_device";var A=E;var P=class P{constructor(r,e,t,i,s={}){let o=Object.assign({id:void 0,muted:!1,probability:1,velocityDeviation:0,releaseVelocity:64},s);this._pitch=r,this._start=e,this._duration=t,this._velocity=i,this._muted=o.muted,this._probability=o.probability,this._velocityDeviation=o.velocityDeviation,this._releaseVelocity=o.releaseVelocity,this._id=o.id}get id(){return this._id}get pitch(){return Math.min(Math.max(this._pitch,0),128)}get start(){return this._start}get duration(){return this._duration<=P.MinDuration?P.MinDuration:this._duration}get velocity(){return Math.min(Math.max(this._velocity,0),128)}get muted(){return!!this._muted}get probability(){return this._probability}get velocityDeviation(){return this._velocityDeviation}get releaseVelocity(){return this._releaseVelocity}get serialize(){return{pitch:this.pitch,start_time:this.start,duration:this.duration,velocity:this.velocity,mute:Number(this.muted),probability:this.probability,velocity_deviation:this.velocityDeviation,release_velocity:this.releaseVelocity,note_id:this._id}}clone(){return new P(this._pitch,this._start,this._duration,this._velocity,{id:void 0,muted:this._muted,probability:this._probability,velocityDeviation:this._velocity,releaseVelocity:this._releaseVelocity})}get[Symbol.toStringTag](){return`Note: ${this.pitch} <${this.id}>`}};P.MinDuration=1/128;var N=P;var k=class k extends l{static getPath(r,e){return k.path.replace("$1",`${r}`).replace("$2",`${e}`)}constructor(r){super(r,"clip view",k.path)}hideEnvelope(){return n(this,null,function*(){return this.call("hide_envelope")})}showEnvelope(){return n(this,null,function*(){return this.call("show_envelope")})}showLoop(){return n(this,null,function*(){return this.call("show_loop")})}};k.path="live_set tracks $1 clip_slots $2 clip view";var $=k;var se=(c=>(c[c.Beats=0]="Beats",c[c.Tones=1]="Tones",c[c.Texture=2]="Texture",c[c.RePitch=3]="RePitch",c[c.Complex=4]="Complex",c[c.Rex=5]="Rex",c[c.ComplexPro=6]="ComplexPro",c))(se||{}),oe=(i=>(i[i.Trigger=0]="Trigger",i[i.Gate=1]="Gate",i[i.Toggle=2]="Toggle",i[i.Repeat=3]="Repeat",i))(oe||{}),ae=(e=>(e[e.global=0]="global",e[e.none=1]="none",e[e["8m"]=2]="8m",e[e["4m"]=3]="4m",e[e["2m"]=4]="2m",e[e["1m"]=5]="1m",e[e["2n"]=6]="2n",e[e["2nt"]=7]="2nt",e[e["4n"]=8]="4n",e[e["4nt"]=9]="4nt",e[e["8n"]=10]="8n",e[e["8nt"]=11]="8nt",e[e["16n"]=12]="16n",e[e["16nt"]=13]="16nt",e[e["32n"]=14]="32n",e))(ae||{}),le=(e=>(e.Midi="midi",e.Audio="audio",e))(le||{}),C=["name","is_audio_clip","length"],f=class f extends l{constructor(e,t,i){super(e,"clip",i!=null?i:t.path);this.raw=t;this._id=parseInt(t.id,10),this._name=t.name,this._type=t.is_audio_clip?"midi":"audio",this._length=t.length,this.childrenTransformers={clipView:()=>new $(this.ableton)}}static getSessionPath(e,t){return f.sessionPath.replace("$1",`${e}`).replace("$2",`${t}`)}static getArrangementPath(e,t){return f.arrangementPath.replace("$1",`${e}`).replace("$2",`${t}`)}removeSelectedNotes(e){return n(this,null,function*(){yield Promise.all(e.map(t=>this.removeNotes(t.start,t.duration,t.pitch,1)))})}get name(){return this._name}get type(){return this._type}get length(){return this._length}addNewNotes(e){return n(this,null,function*(){return this.call("add_new_notes",[this.prepareNotes(e)])})}applyNoteModifications(e){return n(this,null,function*(){return this.call("apply_note_modifications",[this.prepareNotes(e)])})}clearAllEnvelopes(){return n(this,null,function*(){return this.call("clear_all_envelopes")})}clearEnvelope(e){return n(this,null,function*(){return this.call("clear_envelope",[e])})}crop(){return n(this,null,function*(){return this.call("crop")})}deselectAllNotes(){return n(this,null,function*(){return this.call("deselect_all_notes")})}duplicateLoop(){return n(this,null,function*(){return this.call("duplicate_loop")})}duplicateRegion(e,t,i,s=-1,o=0){return n(this,null,function*(){return this.call("duplicate_region",[e,t,i,s,o])})}fire(){return n(this,null,function*(){return this.call("fire")})}getNotes(e=0,t=256,i=0,s=127){return n(this,null,function*(){return this.call("get_notes_extended",[i,s,e.toFixed(3),t.toFixed(3)]).then(this.parseNotes.bind(this))})}getNotesById(e){return n(this,null,function*(){return this.call("get_notes_by_id",[...e]).then(this.parseNotes.bind(this))})}getSelectedNotes(){return n(this,null,function*(){return this.call("get_selected_notes_extended").then(this.parseNotes.bind(this))})}movePlayingPos(e){return n(this,null,function*(){return this.call("move_playing_pos",[e])})}quantize(e,t){return n(this,null,function*(){return this.call("quantize",[e,t])})}quantizePitch(e,t,i){return n(this,null,function*(){return this.call("quantize_pitch",[e,t,i])})}removeNotes(e=0,t=256,i=0,s=127){return n(this,null,function*(){return this.call("remove_notes_extended",[i,s,e.toFixed(4),t.toFixed(4)])})}removeNotesById(e){return n(this,null,function*(){return this.call("remove_notes_by_id",[...e])})}scrub(e){return n(this,null,function*(){return this.call("scrub",[e])})}selectAllNotes(){return n(this,null,function*(){return this.call("select_all_notes")})}setFireButtonState(e){return n(this,null,function*(){return this.call("set_fire_button_state",[e])})}stop(){return n(this,null,function*(){return this.call("stop")})}stopScrub(){return n(this,null,function*(){return this.call("stop_scrub")})}prepareNotes(e){return{notes:e.map(t=>t.serialize)}}parseNotes(e){let t=JSON.parse(e).notes.map(i=>new N(i.pitch,i.start_time,i.duration,i.velocity,{id:i.note_id,muted:!!i.mute,probability:i.probability,velocityDeviation:i.velocity_deviation,releaseVelocity:i.release_velocity}));return t.sort((i,s)=>i.start-s.start),t}};f.sessionPath="live_set tracks $1 clip_slots $2 clip",f.arrangementPath="live_set tracks $1 arrangement_clips $2 clip";var v=f;var ce=(t=>(t[t.Stop=0]="Stop",t[t.Playing=1]="Playing",t[t.PlayingOrRecording=2]="PlayingOrRecording",t))(ce||{}),x=["has_clip",{name:"clip",initialProps:C}],me={clip:C},b=class extends l{constructor(e,t,i){super(e,"clip_slot",i!=null?i:t.path,me);this.raw=t;this._id=t.id,this._hasClip=t.has_clip,this._clip=new v(this.ableton,t.clip),this.childrenTransformers={clip:([s])=>s.id==="0"?null:new v(this.ableton,s)}}get hasClip(){return this._hasClip}clip(){return n(this,null,function*(){return this._clip?Promise.resolve(this._clip):yield this.children("clip")})}createClip(e=4){return n(this,null,function*(){return yield this.call("create_clip",[e]),yield this.children("clip")})}deleteClip(){return n(this,null,function*(){return this.call("delete_clip")})}duplicateClipTo(e){return n(this,null,function*(){return this.call("create_clip",[e])})}fire(e,t){return n(this,null,function*(){return this.call("fire",[e,t])})}stop(){return n(this,null,function*(){return this.call("stop")})}};b.path="live_set tracks $1 clip_slots $2";var pe=(i=>(i.AudioEffect="audio_effect",i.Instrument="instrument",i.MidiEffect="midi_effect",i.Undefined="undefined",i))(pe||{}),Z=["name","type","class_name","class_display_name"],ue={parameters:_},M=class M extends l{constructor(e,t,i){super(e,"device",i||M.path,ue);this.raw=t;this._id=parseInt(t.id,10),this._name=t.name,this._type=t.type,this._className=t.class_name,this._classDisplayName=t.class_display_name,this.childrenTransformers={parameters:s=>s.map(o=>new u(this.ableton,o))}}get name(){return this._name}get className(){return this._className}get classDisplayName(){return this._classDisplayName}get type(){return this._type}};M.path="live_set tracks $1 devices";var O=M;var _e=(t=>(t[t.In=0]="In",t[t.Auto=1]="Auto",t[t.Off=2]="Off",t))(_e||{}),be=(e=>(e[e.Visible=0]="Visible",e[e.Hidden=1]="Hidden",e))(be||{}),W=(e=>(e.Midi="midi",e.Audio="audio",e))(W||{}),h=["name","has_audio_input"],de={devices:Z,clip_slots:x,mixer_device:Y};function I(m){return r=>typeof r=="number"?r:JSON.parse(r)[m]}var K=class K extends l{constructor(e,t,i){super(e,"track",i!=null?i:t.path,de);this.raw=t;this._id=parseInt(t.id,10),this._name=t.name,this._type=t.has_audio_input?"audio":"midi",this.getterTransformers={available_input_routing_channels:I("available_input_routing_channels"),available_input_routing_types:I("available_input_routing_types"),available_output_routing_channels:I("available_output_routing_channels"),available_output_routing_types:I("available_output_routing_types")},this.childrenTransformers={devices:s=>s.map(o=>new O(this.ableton,o)),mixer_device:([s])=>new A(this.ableton,s),clip_slots:s=>s.map(o=>new b(this.ableton,o))}}static getPath(e){return K.path.replace("$1",`${e}`)}getClips(){return n(this,null,function*(){let e=yield this.children("clip_slots");return yield Promise.all(e.filter(t=>t.hasClip).map(t=>n(this,null,function*(){return yield t.clip()})))})}getClip(e){return n(this,null,function*(){let t=yield this.children("clip_slots");return e<1||e>t.length?Promise.reject(null):yield t[e-1].clip()})}getOrCreateClip(e,t=4){return n(this,null,function*(){let i=yield this.children("clip_slots");if(console.log(e,i.length),e<1||e>i.length)return Promise.reject(null);let s=i[e-1];return s.hasClip?yield s.clip():yield s.createClip(t)})}isGroupTrack(){return n(this,null,function*(){return typeof(yield this.get("available_input_routing_channels"))=="number"})}get name(){return this._name}get type(){return this._type}volume(){return n(this,null,function*(){return(this._mixerDevice=yield this.children("mixer_device")).volume})}panning(){return n(this,null,function*(){return(this._mixerDevice=yield this.children("mixer_device")).panning})}deleteDevice(e){return n(this,null,function*(){return this.call("delete_device",[e])})}duplicateClipSlot(e){return n(this,null,function*(){return this.call("duplicate_clip_slot",[e])})}stopAllClips(){return n(this,null,function*(){return this.call("stop_all_clips")})}deleteClip(e){return n(this,null,function*(){return this.call("delete_clip",[`id ${e.id}`])})}duplicateClipToArrangement(e,t){return n(this,null,function*(){return this.call("duplicate_clip_to_arrangement",[`id ${e.id}`,t])})}jumpInRunningSessionClip(e){return n(this,null,function*(){return this.call("jump_in_running_session_clip",[e])})}get[Symbol.toStringTag](){return`Track <${this.name}>`}};K.path="live_set tracks $1";var d=K;var G=["name","isEmpty"],he={clip_slots:x},V=class V extends l{constructor(e,t,i){super(e,"scene",i!=null?i:t.path,he);this.raw=t;this._id=parseInt(t.id,10),this._name=t.name,this._isEmpty=t.isEmpty,this.childrenTransformers={clip_slots:s=>s.map(o=>new b(this.ableton,o))}}static getPath(e){return V.path.replace("$1",`${e}`)}get name(){return this._name}get isEmpty(){return this._isEmpty}fire(e,t){return n(this,null,function*(){return this.call("fire",[e,t])})}fireAsSelected(e){return n(this,null,function*(){return this.call("fire_as_selected",[e])})}setFireButtonState(e){return n(this,null,function*(){return this.call("set_fire_button_state",[e])})}get[Symbol.toStringTag](){return`${this.name}`}};V.path="live_set scenes $1";var w=V;var ve=(r=>(r[r.none=0]="none",r[r["8m"]=1]="8m",r[r["4m"]=2]="4m",r[r["2m"]=3]="2m",r[r["1m"]=4]="1m",r[r["2n"]=5]="2n",r[r["2nt"]=6]="2nt",r[r["4n"]=7]="4n",r[r["4nt"]=8]="4nt",r[r["8n"]=9]="8n",r[r["8nt"]=10]="8nt",r[r["16n"]=11]="16n",r[r["16nt"]=12]="16nt",r[r["32n"]=13]="32n",r))(ve||{}),ge=(r=>(r[r.none=0]="none",r[r["4n"]=1]="4n",r[r["8n"]=2]="8n",r[r["8nt"]=3]="8nt",r[r["8n_8nt"]=4]="8n_8nt",r[r["16n"]=5]="16n",r[r["16nt"]=6]="16nt",r[r["16n_16nt"]=7]="16n_16nt",r[r["32n"]=8]="32n",r))(ge||{}),ye=(o=>(o[o.FramePosition=0]="FramePosition",o[o.Smpte24=1]="Smpte24",o[o.Smpte25=2]="Smpte25",o[o.Smpte30=3]="Smpte30",o[o.Smpte30Drop=4]="Smpte30Drop",o[o.Smpte29=5]="Smpte29",o))(ye||{}),Pe=(a=>(a.Major="Major",a.Minor="Minor",a.Dorian="Dorian",a.Mixolydian="Mixolydian",a.Lydian="Lydian",a.Phrygian="Phrygian",a.Locrian="Locrian",a.Diminished="Diminished",a["Whole-half"]="Whole-half",a["Whole Tone"]="Whole Tone",a["Minor Blues"]="Minor Blues",a["Minor Pentatonic"]="Minor Pentatonic",a["Major Pentatonic"]="Major Pentatonic",a["Harmonic Minor"]="Harmonic Minor",a["Melodic Minor"]="Melodic Minor",a["Super Locrian"]="Super Locrian",a.Bhairav="Bhairav",a["Hungarian Minor"]="Hungarian Minor",a["Minor Gypsy"]="Minor Gypsy",a.Hirojoshi="Hirojoshi",a["In-Sen"]="In-Sen",a.Iwato="Iwato",a.Kumoi="Kumoi",a.Pelog="Pelog",a.Spanish="Spanish",a))(Pe||{}),fe={scenes:G,tracks:h,master_track:h,return_tracks:h,return_track:h,visible_tracks:h,visible_track:h},L=class L extends l{constructor(r){super(r,"song",L.path,fe),this.childrenTransformers={master_track:e=>new d(this.ableton,e,"live_set master_track"),tracks:e=>e.map(t=>new d(this.ableton,t)),scenes:e=>e.map(t=>new w(this.ableton,t)),return_tracks:e=>e.map(t=>new d(this.ableton,t)),visible_tracks:e=>e.map(t=>new d(this.ableton,t))}}findTrackByName(r){return n(this,null,function*(){return(yield this.children("tracks")).find(t=>t.name.includes(r))})}getAudioTracks(){return n(this,null,function*(){return(yield this.children("tracks")).filter(e=>e.type==="audio")})}getMidiTracks(){return n(this,null,function*(){return(yield this.children("tracks")).filter(e=>e.type==="midi")})}playScene(r){return n(this,null,function*(){let t=(yield this.children("scenes"))[r-1];t&&(yield t.fire())})}captureAndInsertScene(){return n(this,null,function*(){return this.call("capture_and_insert_scene")})}captureMidi(r=0){return n(this,null,function*(){return this.call("capture_midi",[r])})}continuePlaying(){return n(this,null,function*(){return this.call("continue_playing")})}createAudioTrack(r=-1){return n(this,null,function*(){return this.call("create_audio_track",[r])})}createMidiTrack(r=-1){return n(this,null,function*(){return this.call("create_midi_track",[r])})}createReturnTrack(){return n(this,null,function*(){return this.call("create_return_track")})}createScene(r=-1){return n(this,null,function*(){return this.call("create_scene",[r])})}deleteReturnTrack(r){return n(this,null,function*(){return this.call("delete_return_track",[r])})}deleteScene(r){return n(this,null,function*(){return this.call("delete_scene",[r])})}deleteTrack(r){return n(this,null,function*(){return this.call("delete_track",[r])})}duplicateScene(r){return n(this,null,function*(){return this.call("duplicate_scene",[r])})}duplicateTrack(r){return n(this,null,function*(){return this.call("duplicate_track",[r])})}forceLinkBeatTime(){return n(this,null,function*(){return this.call("force_link_beat_time")})}getBeatsLoopLength(){return n(this,null,function*(){return this.call("get_beats_loop_length")})}getBeatsLoopStart(){return n(this,null,function*(){return this.call("get_beats_loop_start")})}getCurrentBeatsSongTime(){return n(this,null,function*(){return this.call("get_current_beats_song_time")})}getCurrentSmpteSongTime(r){return n(this,null,function*(){return this.call("get_current_smpte_song_time",[r])})}isCuePointSelected(){return n(this,null,function*(){return this.call("is_cue_point_selected")})}jumpBy(r){return n(this,null,function*(){return this.call("jump_by",[r])})}jumpToNextCue(){return n(this,null,function*(){return this.call("jump_to_next_cue")})}jumpToPrevCue(){return n(this,null,function*(){return this.call("jump_to_prev_cue")})}playSelection(){return n(this,null,function*(){return this.call("play_selection")})}reEnableAutomation(){return n(this,null,function*(){return this.call("re_enable_automation")})}redo(){return n(this,null,function*(){return this.call("redo")})}scrubBy(r){return n(this,null,function*(){return this.call("scrub_by",[r])})}setOrDeleteCue(){return n(this,null,function*(){return this.call("set_or_delete_cue")})}startPlaying(){return n(this,null,function*(){return this.call("start_playing")})}stopAllClips(r=!0){return n(this,null,function*(){return this.call("stop_all_clips",[r])})}stopPlaying(){return n(this,null,function*(){return this.call("stop_playing")})}tapTempo(){return n(this,null,function*(){return this.call("tap_tempo")})}triggerSessionRecord(r){return n(this,null,function*(){return this.call("trigger_session_record",r?[r]:void 0)})}undo(){return n(this,null,function*(){return this.call("undo")})}};L.path="live_set";var B=L;var xe={detail_clip:C,highlighted_clip_slot:x,selected_parameter:_,selected_scene:G,selected_track:h},q=class q extends l{constructor(r){super(r,"song",q.path,xe),this.childrenTransformers={selected_track:e=>new d(this.ableton,Array.isArray(e)?e[0]:e),selected_scene:e=>new w(this.ableton,Array.isArray(e)?e[0]:e),selected_parameter:e=>new u(this.ableton,Array.isArray(e)?e[0]:e),highlighted_clip_slot:e=>new b(this.ableton,Array.isArray(e)?e[0]:e),detail_clip:e=>new v(this.ableton,Array.isArray(e)?e[0]:e)}}selectTrack(r){return n(this,null,function*(){return this.set("selected_track",`id ${r.id}`)})}selectScene(r){return n(this,null,function*(){return this.set("selected_scene",`id ${r.id}`)})}selectClip(r){return n(this,null,function*(){return this.set("detail_clip",`id ${r.id}`)})}selectParameter(r){return n(this,null,function*(){return this.set("selected_parameter",`id ${r.id}`)})}selectClipSlot(r){return n(this,null,function*(){return this.set("highlighted_clip_slot",`id ${r.id}`)})}selectDevice(r){return n(this,null,function*(){return this.call("select_device",[`id ${r}`])})}};q.path="live_set view";var j=q;var z=class extends y{constructor({host:e="127.0.0.1",port:t=9001,logRequests:i=!1}={}){super();this.messageBus=new Map;this.eventListeners=new Map;this._isConnected=!1;this.song=new B(this);this.songView=new j(this);if(this._host=e,this._port=t,this._logRequests=i,this._isBrowser=typeof window!="undefined",(!this._isBrowser||window.WebSocket===void 0)&&global.WebSocket===void 0)throw new Error("[AbletonLive]: WebSocket implementation not available");this.client=new S,this.handleIncoming=this.handleIncoming.bind(this)}connect(){return n(this,null,function*(){return new Promise((e,t)=>{this.client.on("open",()=>{this._isConnected=!0,console.log(`[AbletonLive] Listening on ${this._host}/ableton-live:${this._port}`),this.emit("connect"),e()}),this.client.on("error",i=>{t(new Error(i.message))}),this.client.on("close",i=>{console.log(`[AbletonLive] Disconnected with code ${i.code}`),this.closeClient()}),this.client.on("reconnect",i=>{console.log(`[AbletonLive] Attempt to reconnect #${i}`)}),this.client.on("message",this.handleIncoming),this.client.open(`ws://${this._host}:${this._port}/ableton-live`),this._isBrowser&&window.addEventListener("beforeunload",()=>{console.log("[AbletonLive] Disconnected by reload"),this.closeClient()})})})}get isConnected(){return this._isConnected}closeClient(){this._isConnected=!1,this.client.close(),this.emit("disconnect")}close(){this.messageBus.clear(),this.eventListeners.size&&(this.sendRaw({action:"close"}),this.eventListeners.clear()),this._isConnected=!1,this.client.close(),this.emit("disconnect")}disconnect(){this.close()}sendRaw(e){if(!this._isConnected)throw new Error("[Ableton Live]: Client not connected to the server");this.client.json(e)}handleIncoming(e){try{let t=JSON.parse(e.data),i=this.messageBus.get(t.uuid);if(this._logRequests&&console.log(t),t.event==="success"&&i)return this.messageBus.delete(t.uuid),i(null,t.result);if(t.event==="callback"&&t.result.listeners){t.result.listeners.map(s=>{let o=this.eventListeners.get(s);o&&o(t.result.data)});return}if(t.event==="error"&&i)return this.messageBus.delete(t.uuid),i(new Error(t.result));if(t.event==="disconnect"){this.close();return}}catch(t){console.log(`[AbletonLive] ${t.stack}`)}}sendCommand(c,p,H){return n(this,arguments,function*(e,t,i,s={},o=2e3){if(!this._isConnected)throw new Error("[Ableton Live]: Client not connected to the server");return new Promise((g,D)=>{Object.keys(s).forEach(T=>s[T]===void 0&&delete s[T]);let F=U(),J={uuid:F,objectId:i,action:e,path:t,args:s};this._logRequests&&console.log("Command:",J);let a=setTimeout(()=>D(new Error("Timeout")),o);this.messageBus.set(F,(T,Q)=>{if(T){D(T);return}clearTimeout(a),g(Q)}),this.sendRaw(J)})})}get(e,t,i){return n(this,null,function*(){return this.sendCommand("get",e,i,{prop:t})})}getChildren(e,t,i){return n(this,null,function*(){return this.sendCommand("children",e,i,t)})}set(e,t,i,s){return n(this,null,function*(){return this.sendCommand("set",e,s,{prop:t,value:i})})}observe(c,p,H){return n(this,arguments,function*(e,t,i,{initialProps:s,liveObjectId:o}={}){let g=U(),D=`${e} ${t}`;return(yield this.sendCommand("observe",e,o,{objectPath:D,property:t,eventId:g,initialProps:s}))===g&&this.eventListeners.set(g,i),()=>n(this,null,function*(){return yield this.removeObserser(e,t,g,o)})})}call(e,t,i,s){return n(this,null,function*(){return this.sendCommand("call",e,i,t,s)})}callMultiple(e,t,i,s){return n(this,null,function*(){return this.sendCommand("callMultiple",e,i,{calls:t},s)})}removeObserser(e,t,i,s){return n(this,null,function*(){yield this.sendCommand("removeObserver",e,s,{eventId:i,objectPath:`${e} ${t}`}),this.eventListeners.delete(i)})}};export{z as AbletonLive,ee as AutomationState,v as Clip,b as ClipSlot,le as ClipType,re as CrossfadeAssign,O as Device,u as DeviceParameter,pe as DeviceType,oe as LaunchMode,ae as LaunchQuantization,A as MixerDevice,N as Note,ie as PanningMode,te as ParameterState,ce as PlayingStatus,ve as Quantization,C as RawClipKeys,x as RawClipSlotKeys,Z as RawDevice,_ as RawDeviceParameterKeys,Y as RawMixerDeviceKeys,G as RawSceneKeys,h as RawTrackKeys,ge as RecordingQuantization,ye as SMPTE,Pe as ScaleName,w as Scene,B as Song,j as SongView,d as Track,be as TrackFoldState,_e as TrackMonitoringState,W as TrackType,se as WarpMode};
